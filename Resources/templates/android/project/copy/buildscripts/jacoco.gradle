apply plugin: 'jacoco'

jacoco {
    toolVersion = "0.8.5"
    // Custom reports directory can be specified like this:
    // reportsDir = file("$buildDir/customJacocoReportDir")
}

tasks.withType(Test) {
    jacoco.includeNoLocationClasses = true
}

task jacocoTestReport(type:JacocoReport, dependsOn: "testDebugUnitTest") {
    group = "Reporting"
    description = "Generate Jacoco coverage reports for Debug build"

    reports {
        html.enabled = true
        xml.enabled = true
        csv.enabled = true
    }

    def excludes = [
            '**/R.class',
            '**/R$*.class',
            '**/*$ViewInjector*.*',
            '**/BuildConfig.*',
            '**/Manifest*.*',
            '**/*Test*.*',
            'android/**/*.*',
            '**/*Fragment.*',
            '**/*Activity.*',
            '**/*Enum.*'
    ]

    // generated classes
    def javaClasses = fileTree(dir: "$buildDir/intermediates/classes/debug", excludes: excludes)
    def kotlinClasses = fileTree(dir: "$buildDir/tmp/kotlin-classes/debug", excludes: excludes)
    classDirectories.from = files([javaClasses, kotlinClasses])

    // sources
    additionalSourceDirs.from = files()
    sourceDirectories.from = files([android.sourceSets.main.java.srcDirs])

    executionData.from = files("$buildDir/jacoco/testDebugUnitTest.exec")
}